<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wiatec.blive.orm.dao.ChannelDao">

    <sql id="select">
        SELECT id, userId, available, rating, title, message, url, rtmp_url, rtmp_key,
            playUrl, preview, category, type, price, startTime
        FROM bvision_channel_live
    </sql>

    <select id="selectAllAvailable" resultType="com.wiatec.blive.orm.pojo.ChannelInfo">
        <include refid="select"/>
        WHERE available=1
        ORDER BY startTime DESC
    </select>

    <select id="searchByLikeTitle" resultType="com.wiatec.blive.orm.pojo.ChannelInfo">
        <include refid="select"/>
        WHERE available=1 AND title LIKE concat('%',#{title},'%')
        ORDER BY startTime DESC
    </select>

    <select id="selectOneByUserId" resultType="com.wiatec.blive.orm.pojo.ChannelInfo">
      <include refid="select"/>
        WHERE userId=#{userId}
    </select>

    <select id="countByUserId" resultType="java.lang.Integer">
      SELECT COUNT(*) count FROM bvision_channel_live
      WHERE userId=#{userId}
    </select>

    <update id="insertChannel">
        INSERT IGNORE INTO bvision_channel_live (title, url, rtmp_url, rtmp_key, playUrl,
                                                 preview, category, userId)
        VALUES (#{title}, #{url}, #{rtmpUrl}, #{rtmpKey}, #{playUrl}, '1', '1', #{userId})
    </update>

    <update id="updateChannel">
        UPDATE IGNORE bvision_channel_live
        SET url=#{url}, rtmp_url=#{rtmpUrl}, rtmp_key = #{rtmpKey}, playUrl=#{playUrl}
        WHERE userId=#{userId}
    </update>

    <update id="updateTitleAndMessageByUserId">
        UPDATE bvision_channel_live
        SET title=#{title}, message=#{message}
        WHERE userId=#{userId}
    </update>

    <update id="updateTitleByUserId">
        UPDATE bvision_channel_live
        SET title=#{title}
        WHERE userId=#{userId}
    </update>

    <update id="updateMessageByUserId">
        UPDATE bvision_channel_live
        SET message=#{message}
        WHERE userId=#{userId}
    </update>

    <update id="updatePriceByUserId">
        UPDATE bvision_channel_live
        SET price=#{price}
        WHERE userId=#{userId}
    </update>

    <update id="updateAllSettingByUserId">
        UPDATE bvision_channel_live
        SET title=#{title}, message=#{message}, price=#{price}, rating = #{rating}
        WHERE userId=#{userId}
    </update>

    <update id="updateAvailableByUserId">
        UPDATE bvision_channel_live
        SET available=1, startTime=now()
        WHERE userId=#{userId}
    </update>

    <update id="updateUnavailableByUserId">
        UPDATE bvision_channel_live
        SET available=0
        WHERE userId=#{userId}
    </update>

    <update id="updatePreviewByUserId" parameterType="com.wiatec.blive.orm.pojo.ChannelInfo">
        UPDATE bvision_channel_live
        SET preview=#{preview}
        WHERE userId=#{userId}
    </update>

</mapper>